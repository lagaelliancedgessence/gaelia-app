<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GAELIA SERENITY - Votre compagnon de bien-√™tre holistique</title>
  <meta name="google-site-verification" content="AafQRLYkSruge6D3kFw9WZQvbX38PH4e7JTR42c5724" />
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <link rel="canonical" href="https://gaeliaserenity.web.app/">
  <script 
  src="https://www.paypal.com/sdk/js?client-id=BAAof8wHlbU5qbvdYFBWJAPUH2m--NNJnyPUkXX5gA95g8GR06if_a4uZfoUnasteyxUWoC22RSkvozxNQ&components=hosted-buttons&disable-funding=venmo&currency=USD">
</script>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- Stripe -->
  <script src="https://js.stripe.com/v3/"></script>
  
  <!-- PayPal SDK avec vos cl√©s LIVE -->
  <script src="https://www.paypal.com/sdk/js?client-id=AcNF2-rJ85KJ-MOvUU6Vc2LroUm2_EqJiiR1IRCtf8Uw6helY0qo-0mTb565DIFPBlhM1r9z1rgK-p30&currency=EUR&vault=true&intent=subscription"></script>
  
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-storage-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
  
  <!-- Google Sign-In -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  
  <!-- TensorFlow.js pour l'analyse d'images -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet@latest"></script>
  
  <!-- Webcam.js pour l'acc√®s √† la cam√©ra -->
  <script src="https://cdn.jsdelivr.net/npm/webcam-easy@1.0.5/dist/webcam-easy.min.js"></script>
  
  <style>
    /* Styles de base */
    :root {
      --primary: #4CAF50;
      --secondary: #2196F3;
      --accent: #FF9800;
      --dark: #333;
      --light: #f8f9fa;
      --danger: #f44336;
      --success: #4CAF50;
      --warning: #ff9800;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      line-height: 1.6;
      color: var(--dark);
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    }
    
    /* Header et Navigation */
    header {
      background: white;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      position: fixed;
      width: 100%;
      top: 0;
      z-index: 1000;
    }
    
    nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 5%;
      max-width: 1400px;
      margin: 0 auto;
    }
    
    .logo {
      font-size: 1.8rem;
      font-weight: bold;
      color: var(--primary);
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .logo i {
      color: var(--accent);
    }
    
    .nav-links {
      display: flex;
      gap: 2rem;
      list-style: none;
    }
    
    .nav-links a {
      text-decoration: none;
      color: var(--dark);
      font-weight: 500;
      transition: color 0.3s;
    }
    
    .nav-links a:hover {
      color: var(--primary);
    }
    
    .auth-buttons {
      display: flex;
      gap: 1rem;
    }
    
    /* Boutons */
    .btn {
      padding: 0.8rem 1.5rem;
      border: none;
      border-radius: 25px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    
    .btn-primary {
      background: var(--primary);
      color: white;
    }
    
    .btn-primary:hover {
      background: #45a049;
      transform: translateY(-2px);
    }
    
    .btn-secondary {
      background: var(--secondary);
      color: white;
    }
    
    .btn-outline {
      background: transparent;
      border: 2px solid var(--primary);
      color: var(--primary);
    }
    
    .btn-outline:hover {
      background: var(--primary);
      color: white;
    }
    
    /* Sections principales */
    .hero {
      padding: 8rem 5% 4rem;
      text-align: center;
      background: linear-gradient(rgba(255,255,255,0.9), rgba(255,255,255,0.9)), url('https://images.unsplash.com/photo-1576091160399-112ba8d25d1f?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80');
      background-size: cover;
      background-position: center;
    }
    
    .hero h1 {
      font-size: 3rem;
      margin-bottom: 1rem;
      color: var(--dark);
    }
    
    .hero p {
      font-size: 1.2rem;
      color: #3498db;
      max-width: 700px;
      margin: 0 auto 2rem;
    }
    
    .features {
      padding: 4rem 5%;
      max-width: 1400px;
      margin: 0 auto;
    }
    
    .features h2 {
      text-align: center;
      margin-bottom: 3rem;
      font-size: 2.5rem;
      color: var(--dark);
    }
    
    .features-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 2rem;
    }
    
    .feature-card {
      background: white;
      padding: 2rem;
      border-radius: 15px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      transition: transform 0.3s;
    }
    
    .feature-card:hover {
      transform: translateY(-5px);
    }
    
    .feature-card i {
      font-size: 2.5rem;
      color: var(--primary);
      margin-bottom: 1rem;
    }
    
    /* Section Scanner */
    .scanner-section {
      padding: 4rem 5%;
      background: white;
      margin: 2rem 5%;
      border-radius: 15px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.1);
    }
    
    .scanner-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 3rem;
      margin-top: 2rem;
    }
    
    .scanner-preview {
      background: #f8f9fa;
      border-radius: 10px;
      padding: 1rem;
      min-height: 400px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    
    #scannerCanvas {
      max-width: 100%;
      border-radius: 8px;
      display: none;
    }
    
    .scanner-controls {
      display: flex;
      gap: 1rem;
      margin-top: 1rem;
      flex-wrap: wrap;
    }
    
    .scanner-results {
      background: #f8f9fa;
      border-radius: 10px;
      padding: 2rem;
    }
    
    .analysis-result {
      background: white;
      padding: 1.5rem;
      border-radius: 8px;
      margin-bottom: 1rem;
      border-left: 4px solid var(--primary);
    }
    
    .severity-indicator {
      display: inline-block;
      padding: 0.3rem 0.8rem;
      border-radius: 20px;
      font-size: 0.9rem;
      font-weight: bold;
      margin-top: 0.5rem;
    }
    
    .severity-low { background: #d4edda; color: #155724; }
    .severity-medium { background: #fff3cd; color: #856404; }
    .severity-high { background: #f8d7da; color: #721c24; }
    
    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 2000;
      align-items: center;
      justify-content: center;
    }
    
    .modal-content {
      background: white;
      padding: 2rem;
      border-radius: 15px;
      max-width: 500px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
    }
    
    .close-modal {
      float: right;
      font-size: 1.5rem;
      cursor: pointer;
      color: #3498db;
    }
    
    /* Formulaires */
    .form-group {
      margin-bottom: 1.5rem;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
    }
    
    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 0.8rem;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 1rem;
    }
    
    /* Chat */
    .chat-container {
      background: white;
      border-radius: 15px;
      padding: 2rem;
      margin: 2rem 5%;
      box-shadow: 0 5px 20px rgba(0,0,0,0.1);
    }
    
    .chat-messages {
      height: 300px;
      overflow-y: auto;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 1rem;
      background: #f8f9fa;
    }
    
    .message {
      margin-bottom: 1rem;
      padding: 0.8rem;
      border-radius: 8px;
      max-width: 80%;
    }
    
    .message.user {
      background: var(--primary);
      color: white;
      margin-left: auto;
    }
    
    .message.bot {
      background: #e9ecef;
      color: var(--dark);
    }
    
    /* Section Ressources */
    .resources-section {
      padding: 4rem 5%;
      max-width: 1400px;
      margin: 0 auto;
    }
    
    .resources-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 2rem;
      margin-top: 2rem;
    }
    
    .resource-card {
      background: white;
      padding: 2rem;
      border-radius: 15px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      transition: all 0.3s;
      position: relative;
    }
    
    .resource-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0,0,0,0.15);
    }
    
    .resource-card.premium {
      border: 2px solid var(--accent);
    }
    
    .resource-icon {
      font-size: 2.5rem;
      color: var(--primary);
      margin-bottom: 1rem;
    }
    
    .resource-card h3 {
      margin-bottom: 1rem;
      color: var(--dark);
    }
    
    .resource-card p {
      color: #666;
      margin-bottom: 1.5rem;
      line-height: 1.6;
    }
    
    .download-btn {
      width: 100%;
      justify-content: center;
    }
    
    /* Footer */
    footer {
      background: var(--dark);
      color: white;
      padding: 3rem 5%;
      margin-top: 4rem;
    }
    
    .footer-content {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 2rem;
      max-width: 1400px;
      margin: 0 auto;
    }
    
    .footer-links {
      list-style: none;
      margin-top: 1rem;
    }
    
    .footer-links li {
      margin-bottom: 0.5rem;
    }
    
    .footer-links a {
      color: #ccc;
      text-decoration: none;
      transition: color 0.3s;
    }
    
    .footer-links a:hover {
      color: var(--primary);
    }
    
    .copyright {
      text-align: center;
      margin-top: 3rem;
      padding-top: 2rem;
      border-top: 1px solid rgba(255,255,255,0.1);
      color: #ccc;
      font-size: 0.9rem;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .scanner-container {
        grid-template-columns: 1fr;
      }
      
      .nav-links {
        display: none;
      }
      
      .hero h1 {
        font-size: 2rem;
      }
      
      .footer-content {
        grid-template-columns: 1fr;
        text-align: center;
      }
    }
    
    /* Badge Premium */
    .premium-badge {
      background: var(--accent);
      color: white;
      padding: 0.3rem 0.8rem;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: bold;
      display: inline-block;
      margin-left: 0.5rem;
    }
    
    /* Indicateur de frappe */
    .typing-indicator {
      display: none;
      align-items: center;
      gap: 0.5rem;
      margin: 1rem 0;
    }
    
    .typing-dot {
      width: 8px;
      height: 8px;
      background: var(--primary);
      border-radius: 50%;
      animation: typing 1.4s infinite;
    }
    
    .typing-dot:nth-child(2) { animation-delay: 0.2s; }
    .typing-dot:nth-child(3) { animation-delay: 0.4s; }
    
    @keyframes typing {
      0%, 60%, 100% { transform: translateY(0); }
      30% { transform: translateY(-10px); }
    }

    /* Social buttons in auth modal */
    #login-facebook {
      background: #1877F2;
      color: white;
      border: none;
    }
    #login-facebook:hover {
      background: #166FE5;
    }

    #login-twitter {
      background: #1DA1F2;
      color: white;
      border: none;
    }
    #login-twitter:hover {
      background: #1A91DA;
    }

    /* Social links in footer */
    .social-container {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin: 20px 0;
      flex-wrap: wrap;
    }
    .social-container a {
      text-decoration: none;
      font-weight: bold;
      color: #fff;
      background: rgba(255,255,255,0.1);
      padding: 8px 15px;
      border-radius: 20px;
      display: flex;
      align-items: center;
      gap: 5px;
      transition: all 0.3s;
    }
    .social-container a:hover {
      background: var(--primary);
      transform: translateY(-2px);
    }
    
    /* Styles pour les plans premium */
    .plan-selection {
      display: flex;
      gap: 1rem;
      margin: 2rem 0;
      justify-content: center;
    }
    
    .plan-card {
      background: white;
      border: 2px solid #ddd;
      border-radius: 15px;
      padding: 2rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
      min-width: 200px;
    }
    
    .plan-card:hover {
      border-color: var(--primary);
      transform: translateY(-5px);
    }
    
    .plan-card.active {
      border-color: var(--primary);
      background: #f0f9ff;
    }
    
    .plan-card h3 {
      color: var(--dark);
      margin-bottom: 1rem;
    }
    
    .plan-price {
      font-size: 2rem;
      font-weight: bold;
      color: var(--primary);
      margin: 1rem 0;
    }
    
    .plan-features {
      list-style: none;
      text-align: left;
      margin: 1rem 0;
    }
    
    .plan-features li {
      margin-bottom: 0.5rem;
      padding-left: 1.5rem;
      position: relative;
    }
    
    .plan-features li:before {
      content: "‚úì";
      color: var(--success);
      position: absolute;
      left: 0;
    }
    
    /* Conteneurs de paiement */
    .payment-container {
      margin-top: 2rem;
      padding: 2rem;
      background: #f8f9fa;
      border-radius: 10px;
    }
    
    .payment-methods {
      display: flex;
      gap: 1rem;
      margin-bottom: 2rem;
      flex-wrap: wrap;
    }
    
    .payment-method-btn {
      flex: 1;
      min-width: 150px;
    }
    
    .payment-form {
      display: none;
      animation: fadeIn 0.3s ease;
    }
    
    .payment-form.active {
      display: block;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>

<body>
  <!-- Header -->
  <header>
    <nav>
      <div class="logo">
        <i class="fas fa-heartbeat"></i>
        GAELIA SERENITY
      </div>
      <ul class="nav-links">
        <li><a href="#home">Accueil</a></li>
        <li><a href="#features">Fonctionnalit√©s</a></li>
        <li><a href="#scanner">Scanner</a></li>
        <li><a href="#resources">Ressources</a></li>
        <li><a href="#chat">Chat</a></li>
        <li><a href="#about">√Ä Propos</a></li>
      </ul>
      <div class="auth-buttons">
        <button class="btn btn-outline" onclick="openAuthModal()">
          <i class="fas fa-user"></i>Connexion
        </button>
        <button class="btn btn-primary" onclick="openPremiumModal()">
          <i class="fas fa-crown"></i>Premium
        </button>
      </div>
    </nav>
  </header>

  <!-- Hero Section -->
  <section class="hero" id="home">
    <h1>Votre sant√© entre de bonnes mains</h1>
    <p>GAELIA SERENITY combine m√©decine traditionnelle et technologie moderne pour votre bien-√™tre holistique</p>
    <button class="btn btn-primary btn-lg" onclick="openScanner()">
      <i class="fas fa-camera"></i>Essayer le Scanner
    </button>
  </section>

  <!-- Features Section -->
  <section class="features" id="features">
    <h2>Nos Fonctionnalit√©s</h2>
    <div class="features-grid">
      <div class="feature-card">
        <i class="fas fa-brain"></i>
        <h3>M√©ditation Guid√©e</h3>
        <p>Sessions de m√©ditation personnalis√©es pour r√©duire le stress et am√©liorer la concentration.</p>
      </div>
      <div class="feature-card">
        <i class="fas fa-apple-alt"></i>
        <h3>Nutrition Intelligente</h3>
        <p>Plans alimentaires adapt√©s √† vos besoins sp√©cifiques et objectifs de sant√©.</p>
      </div>
      <div class="feature-card">
        <i class="fas fa-dumbbell"></i>
        <h3>Exercices Personnalis√©s</h3>
        <p>Programmes d'exercices adapt√©s √† votre condition physique et objectifs.</p>
      </div>
      <div class="feature-card">
        <i class="fas fa-stethoscope"></i>
        <h3>Scanner Corporel</h3>
        <p>Analyse virtuelle pour d√©tecter les signes pr√©coces de probl√®mes de sant√©.</p>
        <button class="btn btn-primary" onclick="openScanner()">
          <i class="fas fa-camera"></i>Utiliser le Scanner
        </button>
      </div>
    </div>
  </section>

  <!-- Scanner Section -->
  <section class="scanner-section" id="scanner">
    <h2><i class="fas fa-camera"></i> Scanner Corporel Intelligent</h2>
    <p>Analysez une zone de votre corps pour d√©tecter d'√©ventuels probl√®mes de sant√©. Notre IA analyse les images pour identifier des signes visibles de conditions m√©dicales.</p>
    
    <div class="scanner-container">
      <div class="scanner-preview">
        <video id="webcam" autoplay playsinline style="display: none;"></video>
        <canvas id="scannerCanvas"></canvas>
        <div id="scannerPlaceholder">
          <i class="fas fa-camera fa-4x" style="color: #ccc; margin-bottom: 1rem;"></i>
          <p>Appuyez sur "D√©marrer la cam√©ra" pour commencer l'analyse</p>
        </div>
        
        <div class="scanner-controls">
          <button class="btn btn-primary" onclick="startCamera()" id="startCameraBtn">
            <i class="fas fa-video"></i>D√©marrer la cam√©ra
          </button>
          <button class="btn btn-secondary" onclick="captureImage()" id="captureBtn" disabled>
            <i class="fas fa-camera"></i>Capturer l'image
          </button>
          <button class="btn btn-outline" onclick="uploadImage()" id="uploadBtn">
            <i class="fas fa-upload"></i>T√©l√©charger une image
          </button>
          <button class="btn btn-primary" onclick="analyzeImage()" id="analyzeBtn" disabled>
            <i class="fas fa-search"></i>Analyser
          </button>
        </div>
        
        <input type="file" id="imageUpload" accept="image/*" style="display: none;" onchange="handleImageUpload(event)">
        
        <div class="form-group" style="margin-top: 1rem; width: 100%;">
          <label for="bodyPart">Zone du corps analys√©e:</label>
          <select id="bodyPart" class="form-control">
            <option value="visage">Visage</option>
            <option value="mains">Mains</option>
            <option value="pieds">Pieds</option>
            <option value="torse">Torse</option>
            <option value="dos">Dos</option>
            <option value="abdomen">Abdomen</option>
            <option value="yeux">Yeux</option>
            <option value="peau">Peau</option>
          </select>
        </div>
        
        <div class="form-group" style="width: 100%;">
          <label for="symptoms">Sympt√¥mes ressentis (facultatif):</label>
          <textarea id="symptoms" rows="3" placeholder="D√©crivez vos sympt√¥mes..."></textarea>
        </div>
      </div>
      
      <div class="scanner-results">
        <h3><i class="fas fa-chart-line"></i> R√©sultats de l'analyse</h3>
        <div id="analysisResults">
          <p style="color: #3498db; text-align: center; padding: 2rem;">
            Les r√©sultats de l'analyse appara√Ætront ici apr√®s le scan.
          </p>
        </div>
        
        <div id="recommendations" style="display: none;">
          <h4><i class="fas fa-lightbulb"></i> Recommandations</h4>
          <div id="recommendationsContent"></div>
        </div>
        
        <div id="medicalHistory" style="margin-top: 2rem;">
          <h4><i class="fas fa-history"></i> Historique des scans</h4>
          <div id="historyList"></div>
        </div>
      </div>
    </div>
    
    <div style="margin-top: 2rem; padding: 1.5rem; background: #e8f5e9; border-radius: 8px;">
      <h4><i class="fas fa-exclamation-triangle"></i> Avertissement m√©dical</h4>
      <p style="font-size: 0.9rem; color: #3498db;">
        Ce scanner est un outil d'analyse pr√©liminaire et ne remplace pas une consultation m√©dicale professionnelle. 
        Les r√©sultats sont bas√©s sur une analyse algorithmique et doivent √™tre confirm√©s par un professionnel de sant√©. 
        En cas de sympt√¥mes graves, consultez imm√©diatement un m√©decin.
      </p>
    </div>
  </section>

  <!-- Modal d'authentification -->
  <div id="authModal" class="modal">
    <div class="modal-content">
      <span class="close-modal" onclick="closeAuthModal()">&times;</span>
      <h2>Connexion / Inscription</h2>
      
      <div class="form-group">
        <label>Email</label>
        <input type="email" id="email" placeholder="votre@email.com">
      </div>
      
      <div class="form-group">
        <label>Mot de passe</label>
        <input type="password" id="password" placeholder="Votre mot de passe">
      </div>
      
      <button class="btn btn-primary" style="width: 100%; margin-bottom: 1rem;">
        <i class="fas fa-sign-in-alt"></i>Se connecter
      </button>
      
      <div style="text-align: center; margin: 1rem 0;">
        <span style="color: #3498db;">Ou connectez-vous avec</span>
      </div>
      
      <div id="googleSignInBtn" style="margin-bottom: 1rem;"></div>
      
      <div style="display: flex; gap: 10px; margin: 1rem 0;">
        <button class="btn btn-outline" id="login-facebook" style="flex: 1;">
          <i class="fab fa-facebook"></i> Facebook
        </button>
        <button class="btn btn-outline" id="login-twitter" style="flex: 1;">
          <i class="fab fa-twitter"></i> Twitter
        </button>
      </div>
      
      <div style="border-top: 1px solid #ddd; padding-top: 1rem;">
        <h4>Connexion par SMS</h4>
        <div class="form-group">
          <label>Num√©ro de t√©l√©phone</label>
          <input type="tel" id="phone" placeholder="+33 6 12 34 56 78">
        </div>
        <button class="btn btn-outline" id="sendCodeBtn" style="width: 100%;">
          <i class="fas fa-sms"></i>Envoyer le code par SMS
        </button>
        
        <div id="codeGroup" style="display: none; margin-top: 1rem;">
          <div class="form-group">
            <label>Code de v√©rification</label>
            <input type="text" id="code" placeholder="123456">
          </div>
          <button class="btn btn-primary" onclick="verifySMSCode()" style="width: 100%;">
            <i class="fas fa-check"></i>V√©rifier le code
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Premium avec int√©gration PayPal -->
  <div id="premiumModal" class="modal">
    <div class="modal-content">
      <span class="close-modal" onclick="closePremiumModal()">&times;</span>
      <h2><i class="fas fa-crown"></i> Passez √† Premium</h2>
      <p>D√©bloquez toutes les fonctionnalit√©s avanc√©es</p>
      
      <!-- S√©lection du plan -->
      <div class="plan-selection">
        <div class="plan-card active" id="planEssential" onclick="selectPlan('essential')">
          <h3>Essentiel</h3>
          <div class="plan-price">9.99‚Ç¨<small>/mois</small></div>
          <ul class="plan-features">
            <li>Scanner corporel illimit√©</li>
            <li>Chat IA 24/7</li>
            <li>Ressources de base</li>
            <li>Support email</li>
          </ul>
          <div class="premium-badge">POPULAIRE</div>
        </div>
        
        <div class="plan-card" id="planComplete" onclick="selectPlan('complete')">
          <h3>Complet</h3>
          <div class="plan-price">19.99‚Ç¨<small>/mois</small></div>
          <ul class="plan-features">
            <li>Tout le plan Essentiel</li>
            <li>Analyses avanc√©es IA</li>
            <li>Toutes les ressources premium</li>
            <li>Support prioritaire</li>
            <li>Consultations virtuelles</li>
          </ul>
          <div class="premium-badge">RECOMMAND√â</div>
        </div>
      </div>
      
      <!-- M√©thodes de paiement -->
      <div class="payment-container">
        <h3>Choisissez votre m√©thode de paiement</h3>
        
        <div class="payment-methods">
          <button class="btn btn-outline payment-method-btn" onclick="showPaymentMethod('stripe')">
            <i class="fas fa-credit-card"></i> Carte bancaire
          </button>
          <button class="btn btn-outline payment-method-btn" onclick="showPaymentMethod('paypal')">
            <i class="fab fa-paypal"></i> PayPal
          </button>
          <button class="btn btn-outline payment-method-btn" onclick="showPaymentMethod('mtn')">
            <i class="fas fa-mobile-alt"></i> MTN Money
          </button>
          <button class="btn btn-outline payment-method-btn" onclick="showPaymentMethod('orange')">
            <i class="fas fa-mobile-alt"></i> Orange Money
          </button>
        </div>
        
        <!-- Formulaire Stripe -->
        <div id="stripeForm" class="payment-form">
          <form id="payment-form">
            <div class="form-group">
              <label>Informations de carte</label>
              <div id="card-element" style="padding: 1rem; border: 1px solid #ddd; border-radius: 8px;"></div>
            </div>
            <button type="submit" class="btn btn-primary" id="submit" style="width: 100%;">
              <i class="fas fa-lock"></i>Payer maintenant
            </button>
          </form>
          <div id="payment-result" style="margin-top: 1rem;"></div>
        </div>
        
        <!-- Boutons PayPal -->
        <div id="paypalForm" class="payment-form">
          <div id="paypal-button-container-essential" style="display: none;">
            <h4>Abonnement Essentiel (9.99‚Ç¨/mois)</h4>
            <div id="paypal-button-container-P-33E8843043694591GNFQFJQY"></div>
          </div>
          
          <div id="paypal-button-container-complete" style="display: none;">
            <h4>Abonnement Complet (19.99‚Ç¨/mois)</h4>
            <div id="paypal-button-container-P-2VP61015JE988912LNFQFN4Y"></div>
          </div>
        </div>
        
        <!-- Mobile Money -->
        <div id="mobileMoneyForm" class="payment-form">
          <div class="form-group">
            <label>Num√©ro de t√©l√©phone</label>
            <input type="tel" id="mobilePhone" placeholder="+237 6XX XX XX XX">
          </div>
          <button class="btn btn-primary" onclick="processMobileMoneyPayment()" style="width: 100%;">
            <i class="fas fa-paper-plane"></i>Envoyer la demande de paiement
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Section Ressources -->
  <section class="resources-section" id="resources">
    <h2><i class="fas fa-book"></i> Ressources de Sant√© Holistique</h2>
    <p>Acc√©dez √† nos guides complets sur les diff√©rents aspects de la sant√©. Les ressources premium n√©cessitent un abonnement.</p>
    
    <div class="resources-grid">
      <div class="resource-card">
        <div class="resource-icon">
          <i class="fas fa-spa"></i>
        </div>
        <h3>Sant√© Spirituelle</h3>
        <p>Guide complet pour d√©velopper votre bien-√™tre spirituel et trouver l'harmonie int√©rieure.</p>
        <button class="btn btn-primary download-btn" onclick="downloadResource('spiritual')">
          <i class="fas fa-download"></i>T√©l√©charger le Guide
        </button>
      </div>
      
      <div class="resource-card">
        <div class="resource-icon">
          <i class="fas fa-running"></i>
        </div>
        <h3>Sant√© Physique</h3>
        <p>Programmes d'exercices et conseils pour maintenir une sant√© physique optimale.</p>
        <button class="btn btn-primary download-btn" onclick="downloadResource('physical')">
          <i class="fas fa-download"></i>T√©l√©charger le Guide
        </button>
      </div>
      
      <div class="resource-card">
        <div class="resource-icon">
          <i class="fas fa-brain"></i>
        </div>
        <h3>Sant√© Mentale</h3>
        <p>Techniques et exercices pour am√©liorer votre sant√© mentale et votre bien-√™tre psychologique.</p>
        <button class="btn btn-primary download-btn" onclick="downloadResource('mental')">
          <i class="fas fa-download"></i>T√©l√©charger le Guide
        </button>
      </div>
      
      <div class="resource-card premium">
        <div class="resource-icon">
          <i class="fas fa-bolt"></i>
        </div>
        <h3>Sant√© √ânerg√©tique <span class="premium-badge">PREMIUM</span></h3>
        <p>M√©thodes pour √©quilibrer votre √©nergie vitale et am√©liorer votre vitalit√©.</p>
        <button class="btn btn-primary download-btn" onclick="downloadResource('energy')">
          <i class="fas fa-download"></i>T√©l√©charger (Premium)
        </button>
      </div>
      
      <div class="resource-card premium">
        <div class="resource-icon">
          <i class="fas fa-heart"></i>
        </div>
        <h3>Sant√© √âmotionnelle <span class="premium-badge">PREMIUM</span></h3>
        <p>Guide pour g√©rer vos √©motions et d√©velopper l'intelligence √©motionnelle.</p>
        <button class="btn btn-primary download-btn" onclick="downloadResource('emotional')">
          <i class="fas fa-download"></i>T√©l√©charger (Premium)
        </button>
      </div>
      
      <div class="resource-card">
        <div class="resource-icon">
          <i class="fas fa-meditation"></i>
        </div>
        <h3>Techniques de Mindfulness</h3>
        <p>Exercices de pleine conscience pour r√©duire le stress et am√©liorer la concentration.</p>
        <button class="btn btn-primary download-btn" onclick="downloadResource('mindfulness')">
          <i class="fas fa-download"></i>T√©l√©charger le Guide
        </button>
      </div>
      
      <div class="resource-card premium">
        <div class="resource-icon">
          <i class="fas fa-capsules"></i>
        </div>
        <h3>Nutriments Essentiels <span class="premium-badge">PREMIUM</span></h3>
        <p>Guide complet sur les nutriments essentiels pour une sant√© optimale.</p>
        <button class="btn btn-primary download-btn" onclick="downloadResource('nutrients')">
          <i class="fas fa-download"></i>T√©l√©charger (Premium)
        </button>
      </div>
      
      <div class="resource-card">
        <div class="resource-icon">
          <i class="fas fa-bed"></i>
        </div>
        <h3>Habitudes de Sommeil Sain</h3>
        <p>Conseils pour am√©liorer la qualit√© de votre sommeil et votre r√©cup√©ration.</p>
        <button class="btn btn-primary download-btn" onclick="downloadResource('sleep')">
          <i class="fas fa-download"></i>T√©l√©charger le Guide
        </button>
      </div>
    </div>
  </section>

  <!-- Chat Section -->
  <section class="chat-container" id="chat">
    <h2><i class="fas fa-comments"></i> Chat avec GAELIA</h2>
    <p>Posez vos questions sur la sant√©, la nutrition ou le bien-√™tre</p>
    
    <div class="chat-messages" id="chatMessages">
      <div class="message bot">
        Bonjour ! Je suis GAELIA SERENITY, votre assistant sant√©. Comment puis-je vous aider aujourd'hui ?
      </div>
    </div>
    
    <div class="typing-indicator" id="typingIndicator">
      <div class="typing-dot"></div>
      <div class="typing-dot"></div>
      <div class="typing-dot"></div>
    </div>
    
    <div style="display: flex; gap: 0.5rem;">
      <input type="text" id="chatInput" placeholder="Tapez votre message..." style="flex: 1; padding: 0.8rem; border: 1px solid #ddd; border-radius: 8px;">
      <button class="btn btn-primary" id="sendMessage">
        <i class="fas fa-paper-plane"></i>Envoyer
      </button>
    </div>
  </section>

  <!-- Section √Ä Propos -->
  <section class="resources-section" id="about">
    <h2><i class="fas fa-info-circle"></i> √Ä Propos de GAELIA SERENITY</h2>
    <div class="resource-card" style="max-width: 800px; margin: 0 auto;">
      <h3>Notre Mission</h3>
      <p>GAELIA SERENITY est une plateforme de sant√© holistique qui combine m√©decine traditionnelle et technologie moderne pour offrir une approche compl√®te du bien-√™tre.</p>
      
      <h3 style="margin-top: 1.5rem;">Termes de Service</h3>
      <p>Consultez nos conditions d'utilisation pour comprendre comment nous prot√©geons vos donn√©es et votre vie priv√©e.</p>
      
      <a href="https://drive.google.com/file/d/1comyTDRFD7NWszh7-qMumTq6u58qv869/view?usp=drive_link"
         target="_blank"
         class="btn btn-outline"
         style="margin-top: 1rem; display: inline-block;">
         <i class="fas fa-file-contract"></i> Voir les Termes de Service
      </a>
      
      <h3 style="margin-top: 1.5rem;">En savoir plus</h3>
      <p>D√©couvrez notre vision, notre √©quipe et notre approche de la sant√© holistique.</p>
      
      <a href="https://drive.google.com/file/d/1Zz8WzZLCkbkjwOwP1ITZ69UIo_P9XDoq/view?usp=drive_link"
         target="_blank"
         class="btn btn-outline"
         style="margin-top: 1rem; display: inline-block;">
         <i class="fas fa-book-open"></i> En savoir plus sur GAELIA SERENITY
      </a>
    </div>
  </section>

  <!-- Footer -->
  <footer id="contact">
    <div class="footer-content">
      <div>
        <div class="logo" style="color: white; margin-bottom: 20px;">
          <i class="fas fa-brain"></i>
          <span>GAELIA SERENITY</span>
        </div>
        <p style="color: #ccc; max-width: 300px;">Votre compagnon de bien-√™tre holistique disponible 24h/24, 7j/7.</p>
      </div>

      <div>
        <h3>Produit</h3>
        <ul class="footer-links">
          <li><a href="#features">Fonctionnalit√©s</a></li>
          <li><a href="#resources">Ressources</a></li>
        </ul>
      </div>

      <div>
        <h3>Entreprise</h3>
        <ul class="footer-links">
          <li><a href="https://drive.google.com/file/d/1Zz8WzZLCkbkjwOwP1ITZ69UIo_P9XDoq/view?usp=drive_link" target="_blank">√Ä propos</a></li>
          <li><a href="#contact">Contact</a></li>
          <li><a href="tel:+237650862338">üìû +237 650 862 338</a></li>
          <li><a href="https://wa.me/237650862338" target="_blank">üí¨ WhatsApp</a></li>
          <li><a href="mailto:gdjogaweb@gmail.com">üìß djogaweb@gmail.com</a></li>
          <li><a href="mailto:djodjogaelle52@gmail.com">üìß djodjogaelle52@gmail.com</a></li>
        </ul>
      </div>

      <div>
        <h3>L√©gal</h3>
        <ul class="footer-links">
          <li><a href="https://drive.google.com/file/d/1comyTDRFD7NWszh7-qMumTq6u58qv869/view?usp=drive_link" target="_blank">Confidentialit√©</a></li>
          <li><a href="#">Conditions d'utilisation</a></li>
        </ul>
      </div>
    </div>

    <!-- SOCIAL LINKS -->
    <div class="social-container">
      <a href="https://www.linkedin.com/in/djodjo-ga√´lle-205a1a1a0" target="_blank">
        <i class="fab fa-linkedin"></i> LinkedIn
      </a>
      <a href="https://www.instagram.com/gaellafotsing" target="_blank">
        <i class="fab fa-instagram"></i> Instagram
      </a>
      <a href="https://x.com/DjodjoGaelle" target="_blank">
        <i class="fab fa-twitter"></i> Twitter (X)
      </a>
      <a href="https://web.facebook.com/people/Gaga-Lafleure/61563809747287" target="_blank">
        <i class="fab fa-facebook"></i> Facebook
      </a>
      <a href="https://www.tiktok.com/@gagalafleure6530" target="_blank">
        <i class="fab fa-tiktok"></i> TikTok
      </a>
      <a href="https://linktr.ee/GaelleDjodjo" target="_blank">
        <i class="fas fa-link"></i> Linktree
      </a>
    </div>

    <div class="copyright">
      <p>¬© 2023 GAELIA SERENITY. Tous droits r√©serv√©s. | <i class="fas fa-shield-alt"></i> Donn√©es chiffr√©es | <i class="fas fa-heart"></i> Con√ßu avec empathie</p>
      <p style="margin-top: 10px; font-size: 0.8rem;">Ce service ne remplace pas une consultation m√©dicale. En cas d'urgence, contactez le num√©ro d'urgence m√©dical de votre pays.</p>
    </div>
  </footer>

  <script>
    // ==================== CONFIGURATION ====================
    
    // Configuration Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyBzVYKdek3zFgay4I3O1CbZl8d4xVb7S0M",
      authDomain: "gaelia-sms-authentificator.firebaseapp.com",
      projectId: "gaelia-sms-authentificator",
      storageBucket: "gaelia-sms-authentificator.firebasestorage.app",
      messagingSenderId: "1054771063820",
      appId: "1:1054771063820:web:fbda3c44b8fc51998ed229",
      measurementId: "G-N9WKRLTB5X"
    };

    // Initialiser Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const storage = firebase.storage();
    const db = firebase.firestore();

    // Configuration Stripe
    const stripe = Stripe('pk_test_Tvotre_cle_publique_stripe');
    let elements;
    let cardElement;

    // Configuration API Backend
    const API_BASE_URL = 'http://localhost:3000/api';

    // ==================== √âTAT GLOBAL ====================
    
    let currentUser = {
      id: null,
      email: null,
      isPremium: false,
      token: null
    };

    // Variables pour le scanner
    let webcamStream = null;
    let capturedImage = null;
    let model = null;
    let scanHistory = [];

    // Variables pour la gestion des paiements
    let selectedPlan = 'essential';
    let selectedPaymentMethod = null;

    // ==================== INITIALISATION ====================
    
    document.addEventListener('DOMContentLoaded', function() {
      initializeApp();
    });

    async function initializeApp() {
      // 1. Initialiser l'utilisateur depuis le token
      await initializeUserFromToken();
      
      // 2. Initialiser Google Sign-In
      initGoogleSignIn();
      
      // 3. Initialiser Stripe Elements
      initializeStripeElements();
      
      // 4. Initialiser le mod√®le d'IA
      await initializeAIModel();
      
      // 5. Initialiser les √©couteurs d'√©v√©nements
      setupEventListeners();
      
      // 6. Mettre √† jour l'interface selon le statut premium
      updatePremiumUI();
      
      // 7. Charger l'historique des scans
      loadScanHistory();
      
      // 8. Initialiser les boutons PayPal
      initializePayPalButtons();
    }

    // ==================== GESTION DES PLANS ====================
    
    function selectPlan(plan) {
      selectedPlan = plan;
      
      // Mettre √† jour l'interface
      document.querySelectorAll('.plan-card').forEach(card => {
        card.classList.remove('active');
      });
      
      if (plan === 'essential') {
        document.getElementById('planEssential').classList.add('active');
      } else {
        document.getElementById('planComplete').classList.add('active');
      }
      
      // Mettre √† jour les boutons PayPal
      updatePayPalButtons();
    }

    // ==================== PAYPAL INT√âGRATION ====================
    
    function initializePayPalButtons() {
      // Bouton pour le plan Essentiel
      paypal.Buttons({
        style: {
          shape: 'rect',
          color: 'gold',
          layout: 'vertical',
          label: 'subscribe'
        },
        createSubscription: function(data, actions) {
          return actions.subscription.create({
            plan_id: 'P-33E8843043694591GNFQFJQY'
          });
        },
        onApprove: function(data, actions) {
          handlePayPalSuccess(data.subscriptionID, 'essential');
        },
        onError: function(err) {
          console.error('Erreur PayPal Essentiel:', err);
          alert('Erreur lors du paiement PayPal. Veuillez r√©essayer.');
        }
      }).render('#paypal-button-container-P-33E8843043694591GNFQFJQY');

      // Bouton pour le plan Complet
      paypal.Buttons({
        style: {
          shape: 'rect',
          color: 'gold',
          layout: 'vertical',
          label: 'subscribe'
        },
        createSubscription: function(data, actions) {
          return actions.subscription.create({
            plan_id: 'P-2VP61015JE988912LNFQFN4Y'
          });
        },
        onApprove: function(data, actions) {
          handlePayPalSuccess(data.subscriptionID, 'complete');
        },
        onError: function(err) {
          console.error('Erreur PayPal Complet:', err);
          alert('Erreur lors du paiement PayPal. Veuillez r√©essayer.');
        }
      }).render('#paypal-button-container-P-2VP61015JE988912LNFQFN4Y');
    }

    function updatePayPalButtons() {
      // Afficher le bouton correspondant au plan s√©lectionn√©
      if (selectedPlan === 'essential') {
        document.getElementById('paypal-button-container-essential').style.display = 'block';
        document.getElementById('paypal-button-container-complete').style.display = 'none';
      } else {
        document.getElementById('paypal-button-container-essential').style.display = 'none';
        document.getElementById('paypal-button-container-complete').style.display = 'block';
      }
    }

    async function handlePayPalSuccess(subscriptionID, plan) {
      try {
        // Envoyer la v√©rification au backend
        const response = await fetch(`${API_BASE_URL}/payments/verify-paypal`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${currentUser.token}`
          },
          body: JSON.stringify({
            subscriptionID: subscriptionID,
            plan: plan,
            secretKey: 'EEiUCjXvtJYUAIOb4qd1zrF05GT9S8l3fiWk6DC4i-r2KhWdRA21YYXFL76WIcn3lkkzEYhs6vdym9zh'
          })
        });

        if (response.ok) {
          const result = await response.json();
          
          // Activer le statut premium
          await activatePremium();
          
          // Afficher le succ√®s
          alert(`F√©licitations ! Votre abonnement ${plan === 'essential' ? 'Essentiel' : 'Complet'} a √©t√© activ√©.`);
          closePremiumModal();
          
          // Rediriger ou mettre √† jour l'interface
          location.reload();
        } else {
          throw new Error('√âchec de la v√©rification PayPal');
        }
      } catch (error) {
        console.error('Erreur v√©rification PayPal:', error);
        alert('Erreur lors de la v√©rification du paiement. Contactez le support.');
      }
    }

    // ==================== GESTION DES M√âTHODES DE PAIEMENT ====================
    
    function showPaymentMethod(method) {
      selectedPaymentMethod = method;
      
      // Cacher tous les formulaires
      document.querySelectorAll('.payment-form').forEach(form => {
        form.classList.remove('active');
      });
      
      // Afficher le formulaire s√©lectionn√©
      if (method === 'stripe') {
        document.getElementById('stripeForm').classList.add('active');
      } else if (method === 'paypal') {
        document.getElementById('paypalForm').classList.add('active');
        updatePayPalButtons();
      } else if (method === 'mtn' || method === 'orange') {
        document.getElementById('mobileMoneyForm').classList.add('active');
      }
    }

    async function processMobileMoneyPayment() {
      const phone = document.getElementById('mobilePhone').value;
      if (!phone) {
        alert('Veuillez entrer votre num√©ro de t√©l√©phone');
        return;
      }
      
      try {
        const response = await fetch(`${API_BASE_URL}/payments/mobile-money`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${currentUser.token}`
          },
          body: JSON.stringify({
            provider: selectedPaymentMethod,
            plan: selectedPlan,
            amount: selectedPlan === 'essential' ? 9.99 : 19.99,
            phoneNumber: phone,
            currency: 'EUR'
          })
        });

        if (response.ok) {
          alert(`Demande de paiement envoy√©e √† ${phone}. Suivez les instructions re√ßues par SMS.`);
          closePremiumModal();
        } else {
          throw new Error('√âchec de la demande de paiement');
        }
      } catch (error) {
        console.error('Erreur Mobile Money:', error);
        alert('Erreur lors de la demande de paiement. Veuillez r√©essayer.');
      }
    }

    // ==================== GOOGLE SIGN-IN ====================
    
    function initGoogleSignIn() {
      google.accounts.id.initialize({
        client_id: "725049168978-40j7dl4mgtpm9ondihha1d8maqjao0hu.apps.googleusercontent.com",
        callback: handleGoogleCredential,
        auto_select: false,
        cancel_on_tap_outside: true
      });

      google.accounts.id.renderButton(
        document.getElementById("googleSignInBtn"),
        {
          theme: "outline",
          size: "large",
          text: "continue_with",
          shape: "pill",
          logo_alignment: "left"
        }
      );
    }

    async function handleGoogleCredential(response) {
      try {
        if (!response.credential) {
          throw new Error("Aucun credential Google re√ßu");
        }

        const googleCredential =
          firebase.auth.GoogleAuthProvider.credential(response.credential);

        const result = await firebase
          .auth()
          .signInWithCredential(googleCredential);

        const user = result.user;

        currentUser = {
          id: user.uid,
          email: user.email,
          isPremium: false,
          token: await user.getIdToken()
        };

        alert("Connexion Google r√©ussie !");
        closeAuthModal();
        updateAuthUI();

        console.log("Utilisateur connect√© :", user);

      } catch (error) {
        console.error("Erreur Google Sign-In :", error);
        alert("Erreur lors de la connexion Google");
      }
    }

    // ==================== FACEBOOK AUTH ====================
    async function handleFacebookLogin() {
      try {
        const provider = new firebase.auth.FacebookAuthProvider();
        provider.addScope('email');
        
        const result = await auth.signInWithPopup(provider);
        const user = result.user;
        
        currentUser = {
          id: user.uid,
          email: user.email,
          isPremium: false,
          token: await user.getIdToken()
        };
        
        setToken(currentUser.token);
        alert("Connexion Facebook r√©ussie !");
        closeAuthModal();
        updateAuthUI();
        
      } catch (error) {
        console.error("Erreur Facebook:", error);
        alert("Erreur lors de la connexion Facebook");
      }
    }

    // ==================== TWITTER AUTH ====================
    async function handleTwitterLogin() {
      try {
        const provider = new firebase.auth.TwitterAuthProvider();
        
        const result = await auth.signInWithPopup(provider);
        const user = result.user;
        
        currentUser = {
          id: user.uid,
          email: user.email || user.providerData[0].email,
          isPremium: false,
          token: await user.getIdToken()
        };
        
        setToken(currentUser.token);
        alert("Connexion Twitter r√©ussie !");
        closeAuthModal();
        updateAuthUI();
        
      } catch (error) {
        console.error("Erreur Twitter:", error);
        alert("Erreur lors de la connexion Twitter");
      }
    }

    // ==================== FONCTIONS D'AUTHENTIFICATION ====================
    
    function openAuthModal() {
      document.getElementById("authModal").style.display = "flex";
    }

    function closeAuthModal() {
      document.getElementById("authModal").style.display = "none";
    }

    function updateAuthUI() {
      if (currentUser && currentUser.email) {
        document.querySelector(".auth-buttons").innerHTML = `
          <span style="margin-right:10px;">üë§ ${currentUser.email}</span>
          <button class="btn btn-outline" onclick="logout()">D√©connexion</button>
        `;
      }
    }

    function logout() {
      firebase.auth().signOut().then(() => {
        currentUser = { id: null, email: null, isPremium: false, token: null };
        location.reload();
      });
    }

    // ==================== GESTION UTILISATEUR ====================
    
    async function initializeUserFromToken() {
      const token = getToken();
      
      if (token) {
        try {
          const response = await fetch(`${API_BASE_URL}/auth/verify`, {
            headers: { 'Authorization': `Bearer ${token}` }
          });
          
          if (response.ok) {
            const userData = await response.json();
            currentUser = {
              id: userData.id,
              email: userData.email,
              isPremium: userData.isPremium,
              token: token
            };
            setHttpOnlyCookie('auth_token', token);
            updateAuthUI();
          } else {
            clearAuthData();
          }
        } catch (error) {
          console.error('Erreur v√©rification token:', error);
          clearAuthData();
        }
      }
    }

    function getToken() {
      return localStorage.getItem('gaelia_token');
    }

    function setToken(token) {
      localStorage.setItem('gaelia_token', token);
      currentUser.token = token;
    }

    function clearAuthData() {
      localStorage.removeItem('gaelia_token');
      currentUser = { id: null, email: null, isPremium: false, token: null };
      document.cookie = "auth_token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
      updateAuthUI();
    }

    function setHttpOnlyCookie(name, value) {
      document.cookie = `${name}=${value}; path=/; Secure; SameSite=Strict`;
    }

    // ==================== SCANNER ET RADIOGRAPHIE VIRTUELLE ====================
    
    async function initializeAIModel() {
      try {
        // Charger le mod√®le MobileNet pour la classification d'images
        model = await mobilenet.load();
        console.log('Mod√®le IA charg√© avec succ√®s');
      } catch (error) {
        console.error('Erreur chargement mod√®le IA:', error);
        alert('Impossible de charger le module d\'analyse. Veuillez r√©essayer.');
      }
    }

    async function startCamera() {
      // V√©rifier si l'utilisateur est connect√©
      if (!currentUser || !currentUser.id) {
        alert("Veuillez vous connecter pour utiliser le scanner.");
        openAuthModal();
        return;
      }

      try {
        const constraints = {
          video: {
            width: { ideal: 640 },
            height: { ideal: 480 },
            facingMode: 'environment'
          }
        };
        
        webcamStream = await navigator.mediaDevices.getUserMedia(constraints);
        const video = document.getElementById('webcam');
        video.srcObject = webcamStream;
        video.style.display = 'block';
        
        document.getElementById('scannerPlaceholder').style.display = 'none';
        document.getElementById('captureBtn').disabled = false;
        document.getElementById('startCameraBtn').innerHTML = '<i class="fas fa-stop"></i> Arr√™ter la cam√©ra';
        document.getElementById('startCameraBtn').onclick = stopCamera;
        
        // Afficher le flux vid√©o sur le canvas
        const canvas = document.getElementById('scannerCanvas');
        const ctx = canvas.getContext('2d');
        
        function drawVideo() {
          if (video.readyState === video.HAVE_ENOUGH_DATA) {
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
          }
          requestAnimationFrame(drawVideo);
        }
        drawVideo();
        
      } catch (error) {
        console.error('Erreur acc√®s cam√©ra:', error);
        alert('Impossible d\'acc√©der √† la cam√©ra. V√©rifiez les permissions.');
      }
    }

    function stopCamera() {
      if (webcamStream) {
        webcamStream.getTracks().forEach(track => track.stop());
        webcamStream = null;
        document.getElementById('webcam').style.display = 'none';
        document.getElementById('scannerPlaceholder').style.display = 'block';
        document.getElementById('captureBtn').disabled = true;
        document.getElementById('startCameraBtn').innerHTML = '<i class="fas fa-video"></i> D√©marrer la cam√©ra';
        document.getElementById('startCameraBtn').onclick = startCamera;
      }
    }

    function captureImage() {
      const canvas = document.getElementById('scannerCanvas');
      const video = document.getElementById('webcam');
      
      if (!webcamStream) {
        alert('Veuillez d\'abord d√©marrer la cam√©ra');
        return;
      }
      
      const ctx = canvas.getContext('2d');
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
      
      capturedImage = canvas.toDataURL('image/jpeg');
      document.getElementById('analyzeBtn').disabled = false;
      
      alert('Image captur√©e avec succ√®s ! Cliquez sur "Analyser" pour lancer le diagnostic.');
    }

    function handleImageUpload(event) {
      // V√©rifier si l'utilisateur est connect√©
      if (!currentUser || !currentUser.id) {
        alert("Veuillez vous connecter pour t√©l√©charger une image.");
        openAuthModal();
        return;
      }

      const file = event.target.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = function(e) {
        const img = new Image();
        img.onload = function() {
          const canvas = document.getElementById('scannerCanvas');
          const ctx = canvas.getContext('2d');
          canvas.width = img.width;
          canvas.height = img.height;
          ctx.drawImage(img, 0, 0);
          
          capturedImage = canvas.toDataURL('image/jpeg');
          document.getElementById('analyzeBtn').disabled = false;
          document.getElementById('scannerPlaceholder').style.display = 'none';
          
          alert('Image t√©l√©charg√©e avec succ√®s ! Cliquez sur "Analyser" pour lancer le diagnostic.');
        };
        img.src = e.target.result;
      };
      reader.readAsDataURL(file);
    }

    function uploadImage() {
      // V√©rifier si l'utilisateur est connect√©
      if (!currentUser || !currentUser.id) {
        alert("Veuillez vous connecter pour t√©l√©charger une image.");
        openAuthModal();
        return;
      }
      document.getElementById('imageUpload').click();
    }

    async function analyzeImage() {
      // V√©rifier si l'utilisateur est connect√©
      if (!currentUser || !currentUser.id) {
        alert("Veuillez vous connecter pour analyser une image.");
        openAuthModal();
        return;
      }

      if (!capturedImage) {
        alert('Veuillez d\'abord capturer ou t√©l√©charger une image');
        return;
      }
      
      if (!model) {
        alert('Le module d\'analyse n\'est pas encore charg√©. Veuillez patienter.');
        return;
      }
      
      const analyzeBtn = document.getElementById('analyzeBtn');
      analyzeBtn.disabled = true;
      analyzeBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Analyse en cours...';
      
      try {
        // 1. Pr√©parer l'image pour l'analyse
        const img = new Image();
        img.src = capturedImage;
        
        await new Promise((resolve) => {
          img.onload = resolve;
        });
        
        // 2. Analyse avec le mod√®le IA
        const predictions = await model.classify(img);
        
        // 3. Analyser les sympt√¥mes saisis
        const symptoms = document.getElementById('symptoms').value.toLowerCase();
        const bodyPart = document.getElementById('bodyPart').value;
        
        // 4. G√©n√©rer le rapport d'analyse
        const analysisResult = generateMedicalAnalysis(predictions, symptoms, bodyPart);
        
        // 5. Afficher les r√©sultats
        displayAnalysisResults(analysisResult);
        
        // 6. Sauvegarder dans l'historique
        saveToHistory(analysisResult);
        
        // 7. G√©n√©rer des recommandations
        generateRecommendations(analysisResult);
        
      } catch (error) {
        console.error('Erreur analyse:', error);
        alert('Erreur lors de l\'analyse de l\'image');
      } finally {
        analyzeBtn.disabled = false;
        analyzeBtn.innerHTML = '<i class="fas fa-search"></i> Analyser';
      }
    }

    function generateMedicalAnalysis(predictions, symptoms, bodyPart) {
      const conditions = {
        'visage': {
          'acne': { severity: 'low', confidence: 0.8 },
          'eczema': { severity: 'medium', confidence: 0.6 },
          'rosacea': { severity: 'low', confidence: 0.5 }
        },
        'mains': {
          'eczema': { severity: 'medium', confidence: 0.7 },
          'psoriasis': { severity: 'medium', confidence: 0.6 },
          'arthritis': { severity: 'high', confidence: 0.4 }
        },
        'peau': {
          'rash': { severity: 'medium', confidence: 0.7 },
          'infection': { severity: 'high', confidence: 0.5 },
          'allergy': { severity: 'low', confidence: 0.6 }
        }
      };
      
      // Analyser les pr√©dictions de l'IA
      const aiFindings = predictions.slice(0, 3).map(p => ({
        condition: p.className,
        probability: Math.round(p.probability * 100)
      }));
      
      // Analyser les sympt√¥mes textuels
      const symptomAnalysis = analyzeSymptoms(symptoms);
      
      // D√©terminer la s√©v√©rit√© globale
      let overallSeverity = 'low';
      if (symptomAnalysis.severity === 'high' || aiFindings.some(f => f.probability > 70)) {
        overallSeverity = 'high';
      } else if (symptomAnalysis.severity === 'medium' || aiFindings.some(f => f.probability > 50)) {
        overallSeverity = 'medium';
      }
      
      return {
        timestamp: new Date().toISOString(),
        bodyPart: bodyPart,
        aiFindings: aiFindings,
        symptomAnalysis: symptomAnalysis,
        overallSeverity: overallSeverity,
        conditions: conditions[bodyPart] || {},
        imageData: capturedImage,
        userId: currentUser.id
      };
    }

    function analyzeSymptoms(symptoms) {
      const keywords = {
        'douleur': { weight: 3, severity: 'high' },
        'fi√®vre': { weight: 3, severity: 'high' },
        'rougeur': { weight: 2, severity: 'medium' },
        'd√©mangeaison': { weight: 1, severity: 'low' },
        'gonflement': { weight: 2, severity: 'medium' },
        'fatigue': { weight: 2, severity: 'medium' },
        'naus√©e': { weight: 2, severity: 'medium' }
      };
      
      let severityScore = 0;
      let detectedSymptoms = [];
      
      Object.keys(keywords).forEach(keyword => {
        if (symptoms.includes(keyword)) {
          severityScore += keywords[keyword].weight;
          detectedSymptoms.push({
            symptom: keyword,
            severity: keywords[keyword].severity
          });
        }
      });
      
      let overallSeverity = 'low';
      if (severityScore >= 5) overallSeverity = 'high';
      else if (severityScore >= 2) overallSeverity = 'medium';
      
      return {
        detectedSymptoms: detectedSymptoms,
        severity: overallSeverity,
        score: severityScore
      };
    }

    function displayAnalysisResults(analysis) {
      const resultsDiv = document.getElementById('analysisResults');
      let html = `
        <div class="analysis-result">
          <h4><i class="fas fa-stethoscope"></i> Analyse de la zone: ${analysis.bodyPart}</h4>
          <p><strong>Date:</strong> ${new Date(analysis.timestamp).toLocaleString()}</p>
          
          <div style="margin: 1rem 0;">
            <h5>D√©tection IA:</h5>
            ${analysis.aiFindings.map(finding => `
              <div style="margin: 0.5rem 0; padding: 0.5rem; background: #f8f9fa; border-radius: 5px;">
                ${finding.condition}: ${finding.probability}% de correspondance
              </div>
            `).join('')}
          </div>
          
          ${analysis.symptomAnalysis.detectedSymptoms.length > 0 ? `
            <div style="margin: 1rem 0;">
              <h5>Sympt√¥mes d√©tect√©s:</h5>
              ${analysis.symptomAnalysis.detectedSymptoms.map(s => `
                <span class="severity-${s.severity}" style="margin-right: 0.5rem;">${s.symptom}</span>
              `).join('')}
            </div>
          ` : ''}
          
          <div style="margin-top: 1rem;">
            <h5>S√©v√©rit√© globale:</h5>
            <span class="severity-indicator severity-${analysis.overallSeverity}">
              ${analysis.overallSeverity.toUpperCase()}
            </span>
          </div>
        </div>
      `;
      
      resultsDiv.innerHTML = html;
    }

    function generateRecommendations(analysis) {
      const recommendations = {
        'low': [
          'Continuez √† surveiller la zone',
          'Appliquez une cr√®me hydratante',
          '√âvitez les irritants potentiels'
        ],
        'medium': [
          'Consultez un pharmacien',
          'Appliquez un traitement topique',
          'Surveillez l\'√©volution des sympt√¥mes'
        ],
        'high': [
          'CONSULTEZ UN M√âDECIN DANS LES PLUS BREFS D√âLAIS',
          '√âvitez l\'autom√©dication',
          'Notez l\'√©volution des sympt√¥mes'
        ]
      };
      
      const recDiv = document.getElementById('recommendationsContent');
      recDiv.innerHTML = `
        <ul style="padding-left: 1.5rem;">
          ${recommendations[analysis.overallSeverity].map(rec => `
            <li style="margin-bottom: 0.5rem;">${rec}</li>
          `).join('')}
        </ul>
      `;
      
      document.getElementById('recommendations').style.display = 'block';
    }

    async function saveToHistory(analysis) {
      // Sauvegarder localement
      scanHistory.unshift(analysis);
      localStorage.setItem('gaelia_scan_history', JSON.stringify(scanHistory.slice(0, 10)));
      
      // Sauvegarder sur Firebase si connect√©
      if (currentUser.id) {
        await saveToFirebase(analysis);
      }
      
      // Mettre √† jour l'affichage
      updateHistoryDisplay();
    }

    async function saveToFirebase(analysis) {
      try {
        // Sauvegarder dans Firestore
        await db.collection('scans').add({
          userId: currentUser.id,
          timestamp: firebase.firestore.FieldValue.serverTimestamp(),
          bodyPart: analysis.bodyPart,
          severity: analysis.overallSeverity,
          symptoms: analysis.symptomAnalysis.detectedSymptoms,
          aiFindings: analysis.aiFindings,
          imageData: analysis.imageData.substring(0, 1000) + '...' // Stocker seulement un aper√ßu
        });
        
        console.log('Scan sauvegard√© dans Firebase');
      } catch (error) {
        console.error('Erreur sauvegarde Firebase:', error);
      }
    }

    async function loadScanHistory() {
      // Charger depuis le localStorage
      const saved = localStorage.getItem('gaelia_scan_history');
      if (saved) {
        scanHistory = JSON.parse(saved);
      }
      
      // Charger depuis Firebase si connect√©
      if (currentUser.id) {
        await loadFromFirebase();
      }
      
      updateHistoryDisplay();
    }

    async function loadFromFirebase() {
      try {
        const snapshot = await db.collection('scans')
          .where('userId', '==', currentUser.id)
          .orderBy('timestamp', 'desc')
          .limit(10)
          .get();
        
        snapshot.forEach(doc => {
          const data = doc.data();
          scanHistory.push({
            timestamp: data.timestamp.toDate().toISOString(),
            bodyPart: data.bodyPart,
            overallSeverity: data.severity,
            symptomAnalysis: {
              detectedSymptoms: data.symptoms || []
            },
            aiFindings: data.aiFindings || []
          });
        });
      } catch (error) {
        console.error('Erreur chargement Firebase:', error);
      }
    }

    function updateHistoryDisplay() {
      const historyDiv = document.getElementById('historyList');
      if (scanHistory.length === 0) {
        historyDiv.innerHTML = '<p style="color: #3498db;">Aucun scan enregistr√©</p>';
        return;
      }
      
      historyDiv.innerHTML = scanHistory.slice(0, 5).map((scan, index) => `
        <div style="padding: 0.8rem; border-bottom: 1px solid #eee; cursor: pointer;" 
             onclick="viewScanHistory(${index})">
          <div style="display: flex; justify-content: space-between;">
            <span>${scan.bodyPart}</span>
            <span class="severity-${scan.overallSeverity}" 
                  style="padding: 0.2rem 0.5rem; border-radius: 10px; font-size: 0.8rem;">
              ${scan.overallSeverity}
            </span>
          </div>
          <small style="color: #3498db;">${new Date(scan.timestamp).toLocaleDateString()}</small>
        </div>
      `).join('');
    }

    function viewScanHistory(index) {
      const scan = scanHistory[index];
      displayAnalysisResults(scan);
      generateRecommendations(scan);
    }

    // ==================== AUTHENTIFICATION SMS ====================
    
    let confirmationResult;

    async function sendSMSCode() {
      const phone = document.getElementById('phone').value;
      if (!phone) {
        alert('Veuillez entrer un num√©ro de t√©l√©phone');
        return;
      }
      
      try {
        const appVerifier = new firebase.auth.RecaptchaVerifier('sendCodeBtn', {
          size: 'invisible'
        });
        
        confirmationResult = await auth.signInWithPhoneNumber(phone, appVerifier);
        alert(`Code SMS envoy√© au ${phone}`);
        document.getElementById('codeGroup').style.display = 'block';
      } catch (error) {
        console.error('Erreur envoi SMS:', error);
        alert('Erreur envoi SMS');
      }
    }

    async function verifySMSCode() {
      const code = document.getElementById('code').value;
      if (!code) {
        alert('Veuillez entrer le code de v√©rification');
        return;
      }
      
      try {
        const result = await confirmationResult.confirm(code);
        const user = result.user;
        
        const idToken = await user.getIdToken();
        
        // Mettre √† jour l'utilisateur courant
        currentUser = {
          id: user.uid,
          phone: user.phoneNumber,
          isPremium: false,
          token: idToken
        };
        
        setToken(idToken);
        updateAuthUI();
        alert('Authentification SMS r√©ussie !');
        closeAuthModal();
        
        // V√©rifier le statut premium
        await checkPremiumStatus();
        
      } catch (error) {
        console.error('Erreur v√©rification code:', error);
        alert('Code incorrect');
      }
    }

    // ==================== GESTION PREMIUM ====================
    
    async function checkPremiumStatus() {
      if (!currentUser.id) return;
      
      try {
        const userDoc = await db.collection('users').doc(currentUser.id).get();
        if (userDoc.exists) {
          const userData = userDoc.data();
          currentUser.isPremium = userData.isPremium || false;
          updatePremiumUI();
        }
      } catch (error) {
        console.error('Erreur v√©rification premium:', error);
      }
    }

    async function activatePremium() {
      try {
        await db.collection('users').doc(currentUser.id).set({
          isPremium: true,
          premiumSince: firebase.firestore.FieldValue.serverTimestamp(),
          lastPayment: new Date().toISOString(),
          plan: selectedPlan
        }, { merge: true });
        
        currentUser.isPremium = true;
        updatePremiumUI();
        alert('F√©licitations ! Acc√®s premium activ√©.');
      } catch (error) {
        console.error('Erreur activation premium:', error);
        alert('Erreur lors de l\'activation premium');
      }
    }

    function updatePremiumUI() {
      if (currentUser.isPremium) {
        document.querySelectorAll('.premium-badge').forEach(badge => {
          badge.innerHTML = '<i class="fas fa-crown"></i> D√âBLOQU√â';
          badge.style.background = 'var(--success)';
        });
        
        // D√©bloquer les ressources premium
        document.querySelectorAll('.resource-card.premium .download-btn').forEach(btn => {
          btn.disabled = false;
          btn.innerHTML = '<i class="fas fa-download"></i> T√©l√©charger';
        });
      } else {
        document.querySelectorAll('.premium-badge').forEach(badge => {
          badge.innerHTML = 'PREMIUM';
          badge.style.background = 'var(--accent)';
        });
        
        // Bloquer les ressources premium
        document.querySelectorAll('.resource-card.premium .download-btn').forEach(btn => {
          btn.disabled = true;
          btn.innerHTML = '<i class="fas fa-lock"></i> Premium requis';
        });
      }
    }

    // ==================== PAIEMENTS STRIPE ====================
    
    function initializeStripeElements() {
      if (!stripe) return;
      
      elements = stripe.elements();
      const style = {
        base: {
          color: '#32325d',
          fontFamily: '"Helvetica Neue", Helvetica, sans-serif',
          fontSmoothing: 'antialiased',
          fontSize: '16px',
          '::placeholder': { color: '#aab7c4' }
        },
        invalid: {
          color: '#fa755a',
          iconColor: '#fa755a'
        }
      };
      
      cardElement = elements.create('card', { style: style });
      cardElement.mount('#card-element');
    }

    async function handleStripePayment() {
      const submitButton = document.getElementById('submit');
      submitButton.disabled = true;
      submitButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Traitement...';

      try {
        const response = await fetch(`${API_BASE_URL}/payments/create-payment-intent`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${currentUser.token}`
          },
          body: JSON.stringify({
            plan: selectedPlan,
            amount: selectedPlan === 'essential' ? 999 : 1999 // en centimes
          })
        });

        if (!response.ok) throw new Error('Erreur cr√©ation paiement');

        const { clientSecret } = await response.json();
        const { error, paymentIntent } = await stripe.confirmCardPayment(clientSecret, {
          payment_method: { card: cardElement }
        });

        if (error) {
          document.getElementById('payment-result').innerHTML = 
            `<p style="color: var(--danger);"><i class="fas fa-times"></i> ${error.message}</p>`;
        } else if (paymentIntent.status === 'succeeded') {
          document.getElementById('payment-result').innerHTML = 
            `<p style="color: var(--success);"><i class="fas fa-check"></i> Paiement r√©ussi !</p>`;
          await activatePremium();
          setTimeout(() => {
            closePremiumModal();
            location.reload();
          }, 2000);
        }
      } catch (error) {
        console.error('Erreur paiement:', error);
        document.getElementById('payment-result').innerHTML = 
          `<p style="color: var(--danger);"><i class="fas fa-times"></i> Erreur paiement</p>`;
      } finally {
        submitButton.disabled = false;
        submitButton.innerHTML = '<i class="fas fa-lock"></i> Payer maintenant';
      }
    }

    // ==================== CHAT ====================
    
    async function sendChatMessage(message) {
      if (!currentUser.token) {
        alert('Veuillez vous connecter pour utiliser le chat');
        return;
      }

      try {
        const response = await fetch(`${API_BASE_URL}/chat`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${currentUser.token}`
          },
          body: JSON.stringify({
            message: message,
            userId: currentUser.id
          })
        });

        if (response.ok) {
          const data = await response.json();
          return data.response;
        } else if (response.status === 401) {
          clearAuthData();
          alert('Session expir√©e. Veuillez vous reconnecter.');
        }
      } catch (error) {
        console.error('Erreur chat:', error);
        return "D√©sol√©, une erreur est survenue.";
      }
    }

    // ==================== GESTION DES √âV√âNEMENTS ====================
    
    function setupEventListeners() {
      // SMS Authentication
      document.getElementById('sendCodeBtn').addEventListener('click', sendSMSCode);
      
      // Facebook/Twitter Authentication
      document.getElementById('login-facebook').addEventListener('click', handleFacebookLogin);
      document.getElementById('login-twitter').addEventListener('click', handleTwitterLogin);
      
      // Stripe Payment Form
      document.getElementById('payment-form').addEventListener('submit', async function(event) {
        event.preventDefault();
        await handleStripePayment();
      });

      // Chat interface
      const sendMessageBtn = document.getElementById('sendMessage');
      const chatInput = document.getElementById('chatInput');
      
      sendMessageBtn.addEventListener('click', async function() {
        const message = chatInput.value.trim();
        if (!message) return;
        
        addMessage(message, 'user');
        chatInput.value = '';
        
        document.getElementById('typingIndicator').style.display = 'flex';
        
        const response = await sendChatMessage(message);
        
        document.getElementById('typingIndicator').style.display = 'none';
        if (response) {
          addMessage(response, 'bot');
        }
      });

      // Enter key in chat
      chatInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          sendMessageBtn.click();
        }
      });
    }

    // ==================== FONCTIONS AUXILIAIRES ====================
    
    function addMessage(text, sender) {
      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${sender}`;
      messageDiv.textContent = text;
      document.getElementById('chatMessages').appendChild(messageDiv);
      document.getElementById('chatMessages').scrollTop = document.getElementById('chatMessages').scrollHeight;
    }

    function openPremiumModal() {
      document.getElementById('premiumModal').style.display = 'flex';
      // R√©initialiser la s√©lection
      selectPlan('essential');
      showPaymentMethod('stripe');
    }

    function closePremiumModal() {
      document.getElementById('premiumModal').style.display = 'none';
    }

    function openScanner() {
      document.getElementById('scanner').scrollIntoView({ behavior: 'smooth' });
    }

    function downloadResource(type) {
      if (type === 'energy' || type === 'emotional' || type === 'nutrients') {
        if (!currentUser.isPremium) {
          alert('Cette ressource n√©cessite un abonnement premium.');
          openPremiumModal();
          return;
        }
      }
      
      // Logique de t√©l√©chargement
      alert(`T√©l√©chargement du guide ${type}...`);
      // Ici, vous pouvez ajouter la logique de t√©l√©chargement r√©el
    }

    // Initialiser l'application
    initializeApp();
  </script>

</body>
</html>
